function promise(e){function t(e){return e&&"then"in e&&"function"==typeof e.then}function n(e){for(;e.length;){var n=e.shift(),f=n[0],r=n[1];if("function"==typeof f){try{var u=f(i)}catch(l){r.reject(l)}t(u)?u.then(r.fulfill,r.reject):r.fulfill(u)}else o?r.fulfill(i):r.reject(i)}}e||(e={});var i,f=!0,o=!1,r=[],u=[];return e.then=function(e,t){var i=promise();return r.push([e,i]),u.push([t,i]),setTimeout(function(){f||(o?n(r):n(u))},0),i},e.fulfill=function(e){f&&(i=e,f=!1,o=!0,n(r))},e.reject=function(e){f&&(i=e,f=!1,n(u))},e}void 0!==this.define&&define.amd?define("defer",[],promise):module&&void 0!==module.exports&&(module.exports=promise);