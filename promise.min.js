var promise=function(){function e(n){function t(n){for(;n.length;){var t=n.shift(),r=t[0],f=t[1];if("function"==typeof r){try{var u=r(i)}catch(l){f.reject(l)}e.isPromise(u)?u.then(f.fulfill,f.reject):f.fulfill(u)}else o?f.fulfill(i):f.reject(i)}}n===void 0&&(n={});var i,r=!0,o=!1,f=[],u=[];return n.then=function(n,i){var l=e();return f.push([n,l]),u.push([i,l]),setTimeout(function(){r||(o?t(f):t(u))},0),l},n.fulfill=function(e){r&&(i=e,r=!1,o=!0,t(f))},n.reject=function(e){r&&(i=e,r=!1,t(u))},n}return e.isPromise=function(e){return e&&"then"in e&&"function"==typeof e.then},e.avow=function(n){var t=e();return function(){return n.apply(null,[t.fulfill,t.reject].concat(Array.prototype.slice.apply(arguments))),{then:t.then}}},void 0!==this.define&&define.amd?define("promise",[],e):"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=e),e}();